'use client'

import React, { useState, useEffect, useMemo } from 'react'
import { motion, AnimatePresence } from 'framer-motion'
import { Atom, FlaskConical, Dna, Rocket } from 'lucide-react'

// --- Data Structure ---
type Member = {
  id: string
  name: string
  role: string
  profile: string
}

type Group = {
  id: string
  name: string
  svg: string
  icon: React.ReactNode
  members: Member[]
}

// Data remains the same
const data: Group[] = [
  {
    id: 'g1',
    name: 'قهوه',
    icon: <Atom size="100%" />,
    svg: `url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 300 300' xml:space='preserve'%3E%3Cpath fill='%23DB7E56' d='M534.723 484.673c-19.37 0-36.618 12.781-47.794 32.69a43.738 43.738 0 0 1 4.894 4.212c21.611 21.611 17.035 61.979-9.142 94.448 10.727 24.739 30.019 41.247 52.042 41.247 33.699 0 61.015-38.637 61.015-86.297 0-47.664-27.316-86.3-61.015-86.3z'/%3E%3Cpath fill='%23E59477' d='M534.724 657.204a4.55 4.55 0 0 1-3.398-1.51 4.429 4.429 0 0 1 .393-6.313c25.895-22.58 25.74-47.632-.486-78.835-38.763-46.117-.071-84.265.325-84.644a4.574 4.574 0 0 1 6.413.083 4.421 4.421 0 0 1-.08 6.316c-1.44 1.403-32.976 32.919.325 72.541 29.228 34.771 29.064 65.471-.489 91.242a4.566 4.566 0 0 1-3.003 1.12z'/%3E%3Cpath fill='%23AA6148' d='M473.944 625.673c-33.701 33.701-80.336 41.706-104.165 17.877-23.827-23.827-15.822-70.462 17.877-104.163 33.704-33.702 80.339-41.707 104.166-17.88 23.829 23.828 15.824 70.464-17.878 104.166z'/%3E%3Cpath fill='%23BC715C' d='M400.077 549.591c29.504-29.502 68.917-39.313 94.264-25.315-.8-.951-1.63-1.881-2.519-2.77-23.827-23.827-70.462-15.822-104.166 17.88-33.7 33.701-41.704 80.336-17.877 104.163a44.09 44.09 0 0 0 9.902 7.435c-20.66-24.527-12.047-68.948 20.396-101.393z'/%3E%3Cpath fill='%23E59477' d='M498.038 590.87c-3.768 8.595-8.92 17.108-15.403 25.137 10.727 24.748 30.023 41.262 52.052 41.262 3.876 0 7.661-.533 11.336-1.512-23.678-6.298-42.478-31.953-47.985-64.887zM491.823 521.507c4.249 4.249 7.466 9.232 9.726 14.728 7.986-25.618 24.487-44.731 44.466-50.049-3.672-.976-7.454-1.513-11.328-1.513-19.349 0-36.581 12.751-47.759 32.622a43.63 43.63 0 0 1 4.895 4.212z'/%3E%3Cpath fill='%23BC715C' d='M369.825 643.504a4.552 4.552 0 0 1-1.335-3.471 4.428 4.428 0 0 1 4.742-4.186c34.277 2.344 51.881-15.48 55.4-56.089 5.2-60.02 59.535-59.635 60.082-59.623a4.573 4.573 0 0 1 4.476 4.593 4.42 4.42 0 0 1-4.522 4.41c-2.009-.027-46.594-.041-51.065 51.523-3.92 45.255-25.743 66.847-64.864 64.173a4.546 4.546 0 0 1-2.914-1.33z'/%3E%3Cpath fill='%23DB7E56' d='M403.821 684.717c-16.968 0-31.962-4.996-41.606-13.898a4.535 4.535 0 1 1 6.154-6.665c18.258 16.856 61.638 16.516 94.695-10.931a4.535 4.535 0 1 1 5.793 6.981c-20.488 17.009-44.243 24.513-65.036 24.513z'/%3E%3Cpath fill='%23AA6148' d='M482.117 490.587a4.515 4.515 0 0 1-2.928-1.075 4.532 4.532 0 0 1-.53-6.391c.79-.933 19.702-22.853 50.301-22.853a4.535 4.535 0 1 1 0 9.07c-26.44 0-43.213 19.447-43.38 19.643a4.52 4.52 0 0 1-3.463 1.606z'/%3E%3Cg%3E%3Cpath fill='%23AA6148' d='M560.01 476.024a4.513 4.513 0 0 1-2.643-.852c-3.886-2.793-10.137-3.717-10.199-3.727a4.533 4.533 0 0 1-3.874-5.111c.341-2.483 2.632-4.225 5.111-3.874.864.118 8.599 1.278 14.256 5.344a4.537 4.537 0 0 1-2.651 8.22z'/%3E%3C/g%3E%3Cg%3E%3Cpath fill='%23161616' d='M534.792 657.257a4.541 4.541 0 0 1-3.398-1.511 4.429 4.429 0 0 1 .392-6.313c25.896-22.58 25.74-47.632-.486-78.835-38.763-46.117-.071-84.265.325-84.644a4.573 4.573 0 0 1 6.413.083 4.421 4.421 0 0 1-.08 6.316c-1.439 1.403-32.976 32.918.325 72.541 29.227 34.771 29.064 65.471-.489 91.242a4.552 4.552 0 0 1-3.002 1.121z'/%3E%3Cpath fill='%23161616' d='M405.767 661.872c-15.636 0-29.232-5.167-39.127-15.062-15.173-15.173-19.12-39.668-10.56-65.525a4.536 4.536 0 0 1 5.73-2.88 4.533 4.533 0 0 1 2.88 5.73c-7.459 22.534-4.332 43.566 8.364 56.263 22.021 22.021 65.874 14.005 97.751-17.877 31.879-31.881 39.9-75.732 17.879-97.753-22.023-22.02-65.872-13.997-97.753 17.88-7.061 7.062-13.092 14.855-17.926 23.166a4.535 4.535 0 1 1-7.84-4.562c5.226-8.985 11.737-17.402 19.352-25.017 35.418-35.415 85.027-43.436 110.58-17.88 25.559 25.557 17.538 75.163-17.879 110.58-16.956 16.957-37.634 28.241-58.223 31.776-4.54.775-8.96 1.161-13.228 1.161z'/%3E%3Cpath fill='%23161616' d='M534.791 661.857c-23.251 0-44.263-16.441-56.202-43.978a4.535 4.535 0 0 1 .629-4.651c24.903-30.887 28.972-68.889 9.467-88.394a39.588 39.588 0 0 0-4.389-3.775 4.536 4.536 0 0 1-1.253-5.864c12.489-22.246 31.351-35.005 51.749-35.005 31.935 0 59.083 31.568 64.551 75.063a4.534 4.534 0 0 1-3.935 5.065 4.533 4.533 0 0 1-5.065-3.935c-4.89-38.893-28.253-67.123-55.551-67.123-16.035 0-31.142 9.821-41.898 27.091a47.703 47.703 0 0 1 2.204 2.068c22.683 22.683 19.6 63.68-7.084 98.301 10.586 22.639 27.924 36.065 46.777 36.065 29.611 0 54.357-33.494 56.337-76.254.117-2.501 2.244-4.414 4.741-4.321a4.537 4.537 0 0 1 4.321 4.741c-2.205 47.612-30.932 84.906-65.399 84.906z'/%3E%3Cpath fill='%23161616' d='M369.893 643.557a4.552 4.552 0 0 1-1.335-3.471 4.427 4.427 0 0 1 4.742-4.185c34.277 2.344 51.881-15.48 55.401-56.089 5.2-60.02 59.534-59.635 60.082-59.623a4.574 4.574 0 0 1 4.476 4.593 4.421 4.421 0 0 1-4.522 4.41c-2.009-.027-46.594-.041-51.064 51.523-3.92 45.255-25.743 66.847-64.864 64.173a4.55 4.55 0 0 1-2.916-1.331zM403.889 684.77c-16.968 0-31.962-4.996-41.605-13.898a4.536 4.536 0 0 1 6.154-6.664c18.257 16.853 61.64 16.516 94.695-10.931a4.535 4.535 0 1 1 5.793 6.981c-20.489 17.008-44.244 24.512-65.037 24.512zM482.185 490.64a4.515 4.515 0 0 1-2.928-1.075 4.532 4.532 0 0 1-.53-6.391c.79-.933 19.702-22.853 50.301-22.853a4.535 4.535 0 1 1 0 9.07c-26.44 0-43.213 19.447-43.38 19.643a4.52 4.52 0 0 1-3.463 1.606zM560.078 476.077a4.513 4.513 0 0 1-2.643-.852c-3.886-2.793-10.137-3.717-10.199-3.726a4.533 4.533 0 0 1-3.874-5.111c.341-2.483 2.628-4.233 5.111-3.874.864.118 8.598 1.279 14.256 5.344a4.537 4.537 0 0 1-2.651 8.219z'/%3E%3C/g%3E%3Cg%3E%3Cpath fill='%23DB7E56' d='M208.809 62.154c-19.37 0-36.618 12.781-47.794 32.69a43.738 43.738 0 0 1 4.894 4.212c21.611 21.611 17.035 61.979-9.142 94.448 10.727 24.739 30.019 41.247 52.042 41.247 33.699 0 61.015-38.637 61.015-86.297 0-47.664-27.316-86.3-61.015-86.3z'/%3E%3Cpath fill='%23E59477' d='M208.81 234.684a4.547 4.547 0 0 1-3.398-1.51 4.429 4.429 0 0 1 .393-6.313c25.895-22.58 25.74-47.632-.486-78.835-38.763-46.117-.071-84.265.325-84.644a4.574 4.574 0 0 1 6.413.083 4.421 4.421 0 0 1-.08 6.316c-1.439 1.403-32.976 32.918.325 72.541 29.228 34.771 29.064 65.471-.489 91.242a4.559 4.559 0 0 1-3.003 1.12z'/%3E%3Cpath fill='%23AA6148' d='M148.03 203.154c-33.701 33.701-80.337 41.706-104.165 17.877-23.827-23.827-15.822-70.462 17.877-104.163 33.704-33.702 80.339-41.707 104.166-17.88 23.829 23.828 15.825 70.463-17.878 104.166z'/%3E%3Cpath fill='%23BC715C' d='M74.163 127.072c29.504-29.502 68.917-39.313 94.264-25.315-.8-.951-1.63-1.881-2.519-2.77-23.827-23.827-70.463-15.822-104.166 17.88-33.7 33.701-41.704 80.336-17.877 104.163a44.09 44.09 0 0 0 9.902 7.435c-20.66-24.528-12.047-68.949 20.396-101.393z'/%3E%3Cpath fill='%23E59477' d='M172.124 168.351c-3.768 8.595-8.92 17.108-15.403 25.137 10.727 24.748 30.023 41.262 52.052 41.262 3.876 0 7.661-.533 11.336-1.512-23.678-6.299-42.478-31.954-47.985-64.887zM165.909 98.987c4.249 4.249 7.466 9.232 9.726 14.728 7.986-25.618 24.487-44.731 44.466-50.049-3.672-.976-7.454-1.513-11.328-1.513-19.349 0-36.581 12.751-47.759 32.622a43.748 43.748 0 0 1 4.895 4.212z'/%3E%3Cpath fill='%23BC715C' d='M43.911 220.985a4.552 4.552 0 0 1-1.335-3.471 4.429 4.429 0 0 1 4.742-4.186c34.277 2.344 51.881-15.48 55.4-56.089 5.2-60.02 59.535-59.635 60.082-59.623a4.573 4.573 0 0 1 4.476 4.593 4.42 4.42 0 0 1-4.522 4.41c-2.009-.027-46.594-.041-51.065 51.523-3.92 45.255-25.743 66.847-64.864 64.173a4.558 4.558 0 0 1-2.914-1.33z'/%3E%3Cpath fill='%23DB7E56' d='M77.907 262.198c-16.968 0-31.962-4.996-41.606-13.898a4.535 4.535 0 1 1 6.154-6.664c18.258 16.856 61.638 16.516 94.695-10.931a4.537 4.537 0 0 1 5.794 6.981c-20.489 17.007-44.244 24.512-65.037 24.512z'/%3E%3Cpath fill='%23AA6148' d='M156.203 68.068a4.533 4.533 0 0 1-3.458-7.466c.79-.933 19.702-22.853 50.301-22.853a4.535 4.535 0 1 1 0 9.07c-26.44 0-43.213 19.446-43.38 19.643a4.517 4.517 0 0 1-3.463 1.606z'/%3E%3Cg%3E%3Cpath fill='%23AA6148' d='M234.096 53.505a4.513 4.513 0 0 1-2.643-.852c-3.886-2.793-10.137-3.717-10.199-3.727a4.533 4.533 0 0 1-3.874-5.111c.341-2.483 2.632-4.225 5.111-3.874.864.118 8.598 1.278 14.256 5.344a4.537 4.537 0 0 1-2.651 8.22z'/%3E%3C/g%3E%3Cg%3E%3Cpath fill='%23161616' d='M208.878 234.738a4.545 4.545 0 0 1-3.398-1.511 4.428 4.428 0 0 1 .393-6.313c25.895-22.58 25.74-47.632-.486-78.835-38.763-46.117-.071-84.265.325-84.644a4.574 4.574 0 0 1 6.413.083 4.421 4.421 0 0 1-.08 6.316c-1.439 1.403-32.976 32.918.325 72.541 29.228 34.771 29.064 65.471-.489 91.242a4.56 4.56 0 0 1-3.003 1.121z'/%3E%3Cpath fill='%23161616' d='M79.853 239.352c-15.636 0-29.232-5.167-39.127-15.062-15.173-15.173-19.12-39.668-10.56-65.525a4.536 4.536 0 0 1 5.73-2.88 4.533 4.533 0 0 1 2.88 5.73c-7.459 22.534-4.332 43.566 8.364 56.263 22.021 22.021 65.874 14.005 97.752-17.877 31.879-31.881 39.9-75.732 17.879-97.753-22.023-22.02-65.872-13.997-97.753 17.88-7.062 7.061-13.092 14.855-17.926 23.166a4.535 4.535 0 1 1-7.84-4.562c5.226-8.985 11.737-17.402 19.352-25.017 35.418-35.415 85.027-43.436 110.58-17.88 25.559 25.557 17.538 75.163-17.879 110.58-16.956 16.958-37.634 28.241-58.223 31.776-4.54.776-8.961 1.161-13.229 1.161z'/%3E%3Cpath fill='%23161616' d='M208.877 239.338c-23.251 0-44.263-16.441-56.202-43.978a4.535 4.535 0 0 1 .629-4.651c24.903-30.887 28.972-68.889 9.467-88.394a39.588 39.588 0 0 0-4.389-3.775 4.536 4.536 0 0 1-1.253-5.864c12.489-22.246 31.351-35.005 51.749-35.005 31.935 0 59.083 31.568 64.551 75.063a4.534 4.534 0 0 1-3.935 5.065 4.533 4.533 0 0 1-5.065-3.934c-4.89-38.893-28.253-67.123-55.551-67.123-16.035 0-31.142 9.821-41.898 27.091a47.198 47.198 0 0 1 2.204 2.068c22.683 22.683 19.6 63.68-7.084 98.301 10.585 22.639 27.924 36.065 46.777 36.065 29.611 0 54.357-33.494 56.337-76.254.117-2.501 2.244-4.414 4.741-4.321a4.537 4.537 0 0 1 4.321 4.741c-2.205 47.61-30.932 84.905-65.399 84.905z'/%3E%3Cpath fill='%23161616' d='M43.979 221.038a4.552 4.552 0 0 1-1.335-3.471 4.427 4.427 0 0 1 4.742-4.185c34.277 2.344 51.881-15.48 55.401-56.089 5.2-60.02 59.534-59.635 60.082-59.623a4.575 4.575 0 0 1 4.477 4.593 4.421 4.421 0 0 1-4.522 4.41c-2.009-.027-46.594-.041-51.064 51.523-3.92 45.255-25.743 66.847-64.864 64.173a4.555 4.555 0 0 1-2.917-1.331zM77.975 262.251c-16.968 0-31.962-4.996-41.605-13.898a4.535 4.535 0 1 1 6.154-6.664c18.257 16.853 61.64 16.516 94.695-10.931a4.535 4.535 0 1 1 5.793 6.981c-20.489 17.007-44.244 24.512-65.037 24.512zM156.271 68.121a4.515 4.515 0 0 1-2.928-1.075 4.532 4.532 0 0 1-.53-6.391c.79-.933 19.702-22.853 50.301-22.853a4.535 4.535 0 1 1 0 9.07c-26.44 0-43.213 19.447-43.38 19.643a4.517 4.517 0 0 1-3.463 1.606zM234.164 53.558a4.513 4.513 0 0 1-2.643-.852c-3.886-2.793-10.137-3.717-10.199-3.726a4.532 4.532 0 0 1-3.874-5.111c.341-2.483 2.628-4.233 5.111-3.874.864.118 8.598 1.279 14.256 5.345a4.537 4.537 0 0 1-2.651 8.218z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");`,
    members: [
      {
        id: 'm1',
        name: 'Albert Einstein',
        role: 'Theoretical Physicist',
        profile: '/images/coffee-bean.png',
      },
      {
        id: 'm2',
        name: 'Isaac Newton',
        role: 'Physicist & Mathematician',
        profile: '/images/coffee-bean.png',
      },
      {
        id: 'm3',
        name: 'Galileo Galilei',
        role: 'Astronomer & Physicist',
        profile: '/images/coffee-bean.png',
      },
      {
        id: 'm4',
        name: 'Stephen Hawking',
        role: 'Theoretical Physicist',
        profile: '/images/coffee-bean.png',
      },
      {
        id: 'm5',
        name: 'Richard Feynman',
        role: 'Theoretical Physicist',
        profile: '/images/coffee-bean.png',
      },
      {
        id: 'm6',
        name: 'Max Planck',
        role: 'Quantum Theorist',
        profile: '/images/coffee-bean.png',
      },
      {
        id: 'm7',
        name: 'Carl Sagan',
        role: 'Astrophysicist & Author',
        profile: '/images/coffee-bean.png',
      },
    ],
  },
  {
    id: 'g2',
    name: 'ابزار قهوه‌ساز',
    icon: <FlaskConical size="100%" />,
    svg: `url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='128' height='128'%3E%3Cpath d='M95.48 83.185a1.75 1.75 0 0 1-1.75-1.75v-1.422a1.329 1.329 0 0 0-1.33-1.328h-4.42a1.75 1.75 0 0 1 0-3.5h4.42a4.834 4.834 0 0 1 4.828 4.828v1.422a1.75 1.75 0 0 1-1.748 1.75z' fill='%23ffa375'/%3E%3Cpath d='M84.828 91.643a11.08 11.08 0 0 0 3.152-7.75V72.768H65.73v11.125a11.076 11.076 0 0 0 3.153 7.75z' fill='%23ffb894'/%3E%3Cpath fill='%238299fd' d='M71.147 49.018h11.417v11.417H71.147z'/%3E%3Cpath fill='%23d2ddff' d='M67.842 35.216h18.026v13.802H67.842zM73.803 60.435h6.104v6.104h-6.104z'/%3E%3Cpath fill='%2301eba4' d='M30.722 91.643h66.556v11.156H30.722z'/%3E%3Cpath fill='%2396ffd1' d='M97.278 25.201H30.722v66.442h23.111V35.216h43.445V25.201z'/%3E%3Ccircle cx='42.233' cy='46.684' r='4.566' fill='%238299fd'/%3E%3Ccircle cx='42.233' cy='63.487' r='4.566' fill='%238299fd'/%3E%3Cg fill='%233536c0'%3E%3Cpath d='M48.875 26.951h.563a1.75 1.75 0 0 0 0-3.5h-.563a1.75 1.75 0 0 0 0 3.5z'/%3E%3Cpath d='M103.349 101.049h-4.322v-9.405a1.749 1.749 0 0 0-1.75-1.75h-9.032a12.8 12.8 0 0 0 1.485-6v-5.209h2.67a1.329 1.329 0 0 1 1.328 1.328v1.422a1.75 1.75 0 0 0 3.5 0v-1.422a4.834 4.834 0 0 0-4.828-4.828h-2.67v-2.416a1.749 1.749 0 0 0-1.75-1.75H65.73a1.75 1.75 0 0 0-1.75 1.75v11.125a1.75 1.75 0 1 0 3.5 0v-9.375h18.75v9.375a9.306 9.306 0 0 1-2.188 6H55.583V36.966h10.509v12.053a1.75 1.75 0 0 0 1.75 1.75h12.971v7.916H72.9v-3.958a1.75 1.75 0 1 0-3.5 0v5.708a1.751 1.751 0 0 0 1.75 1.75h.906v4.355a1.75 1.75 0 0 0 1.75 1.75h6.1a1.75 1.75 0 0 0 1.75-1.75v-4.355h.906a1.75 1.75 0 0 0 1.75-1.75v-9.666h1.555a1.75 1.75 0 0 0 1.75-1.75v-7.9a1.75 1.75 0 1 0-3.5 0v6.152H69.592v-10.3h27.685a1.749 1.749 0 0 0 1.75-1.75V25.2a1.749 1.749 0 0 0-1.75-1.75H55.5a1.75 1.75 0 0 0 0 3.5h40.027v6.515H53.833a1.751 1.751 0 0 0-1.75 1.75v54.679H32.472V26.951h9.761a1.75 1.75 0 0 0 0-3.5H30.722a1.75 1.75 0 0 0-1.75 1.75v72.021a1.75 1.75 0 0 0 3.5 0v-3.828h63.055v7.655h-7.548a1.75 1.75 0 0 0 0 3.5h15.37a1.75 1.75 0 1 0 0-3.5zM78.157 64.79h-2.6v-2.605h2.6z'/%3E%3Cpath d='M80.417 101.049h-1.084a1.75 1.75 0 0 0 0 3.5h1.084a1.75 1.75 0 0 0 0-3.5zM72.167 101.049H24.651a1.75 1.75 0 1 0 0 3.5h47.516a1.75 1.75 0 0 0 0-3.5zM35.917 46.684a6.316 6.316 0 1 0 6.316-6.317 6.323 6.323 0 0 0-6.316 6.317zm9.132 0a2.816 2.816 0 1 1-2.816-2.817 2.82 2.82 0 0 1 2.816 2.817zM42.233 60.671a2.82 2.82 0 0 1 2.816 2.816 1.75 1.75 0 1 0 3.5 0 6.316 6.316 0 1 0-6.316 6.313 1.75 1.75 0 1 0 0-3.5 2.817 2.817 0 0 1 0-5.633z'/%3E%3C/g%3E%3C/svg%3E");`,
    members: [
      {
        id: 'm8',
        name: 'Marie Curie',
        role: 'Physicist & Chemist',
        profile: '/images/coffee-bean.png',
      },
      {
        id: 'm9',
        name: 'Dmitri Mendeleev',
        role: 'Creator of Periodic Table',
        profile: '/images/coffee-bean.png',
      },
      {
        id: 'm10',
        name: 'Rosalind Franklin',
        role: 'Chemist & X-ray Crystallographer',
        profile: '/images/coffee-bean.png',
      },
      {
        id: 'm11',
        name: 'Linus Pauling',
        role: 'Chemist & Peace Activist',
        profile: '/images/coffee-bean.png',
      },
      {
        id: 'm12',
        name: 'Antoine Lavoisier',
        role: 'Father of Modern Chemistry',
        profile: '/images/coffee-bean.png',
      },
      {
        id: 'm13',
        name: 'Dorothy Hodgkin',
        role: 'Nobel Laureate in Chemistry',
        profile: '/images/coffee-bean.png',
      },
      {
        id: 'm14',
        name: 'Michael Faraday',
        role: 'Chemist & Physicist',
        profile: '/images/coffee-bean.png',
      },
    ],
  },
  {
    id: 'g3',
    name: 'اکسسوری قهوه',
    icon: <Dna size="100%" />,
    svg: `url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 300 300' xml:space='preserve'%3E%3Cpath fill='%23AA6148' d='M79.16 257.416c-14.429 14.427-34.401 17.855-44.605 7.653-10.194-10.202-6.774-30.171 7.662-44.598 14.43-14.433 34.395-17.858 44.598-7.659 10.203 10.205 6.781 30.171-7.655 44.604z'/%3E%3Cpath fill='%23BC715C' d='M47.697 225.952c13.11-13.113 30.765-17.102 41.541-10.081-.707-1.087-1.488-2.126-2.423-3.059-10.203-10.198-30.168-6.773-44.598 7.659-14.436 14.427-17.856 34.396-7.662 44.598.935.936 1.976 1.716 3.062 2.424-7.019-10.777-3.036-28.434 10.08-41.541z'/%3E%3Cpath fill='%23BC715C' d='M39.159 266.395c-.597 0-1.19-.006-1.785-.018a4.457 4.457 0 0 1-4.369-4.544c.044-2.439 2.03-4.385 4.446-4.385.028 0 .056 0 .084.003 10.06.171 17.986.325 20.183-19.954 2.41-22.217 18.472-26.521 26.65-25.704 2.442.248 4.224 2.436 3.98 4.893-.247 2.442-2.432 4.24-4.844 3.995-1.549-.115-14.935-.694-16.94 17.781-2.71 25.019-14.814 27.933-27.405 27.933z'/%3E%3Cpath fill='%23F4F4F4' d='M231.946 97.044h-5.87v16.302h5.87c21.337 0 22.993 22.591 22.993 29.513v43.851c0 14.262-13.32 27.318-28.863 29.241v15.862c0 .174-.022.343-.024.517 24.483-1.993 45.19-22.432 45.19-45.62v-43.851c0-27.407-15.792-45.815-39.296-45.815z'/%3E%3Cpath fill='%23F4F4F4' d='M85.093 77.754v133.567c.595.467 1.18.948 1.721 1.491 7.691 7.692 7.633 20.926.961 33.159 5.678 14.604 19.834 24.971 36.444 24.971h62.729c21.61 0 39.127-17.519 39.127-39.13V77.754H85.093z'/%3E%3Cpath fill='%23F9F9F9' d='M104.406 245.971c6.672-12.233 6.729-25.467-.961-33.159a18.62 18.62 0 0 0-1.721-1.491V77.754h-16.63v133.567c.595.467 1.18.948 1.721 1.491 7.691 7.692 7.633 20.926.961 33.159 5.678 14.604 19.834 24.971 36.444 24.971h16.63c-16.611 0-30.766-10.367-36.444-24.971z'/%3E%3Cpath fill='%23F4F4F4' d='M152.323 58.889a4.533 4.533 0 0 1-4.535-4.535V29.055a4.535 4.535 0 0 1 9.07 0v25.299a4.533 4.533 0 0 1-4.535 4.535z'/%3E%3Cpath fill='%23F9F9F9' d='M152.323 54.354V29.055c0-1.674.917-3.121 2.268-3.906a4.483 4.483 0 0 0-2.268-.629 4.535 4.535 0 0 0-4.535 4.535v25.299a4.533 4.533 0 0 0 4.535 4.535 4.48 4.48 0 0 0 2.268-.626c-1.352-.785-2.268-2.232-2.268-3.909z'/%3E%3Cpath fill='%23F4F4F4' d='M177.326 61.045a4.536 4.536 0 0 1-4.535-4.535V36.59a4.535 4.535 0 0 1 9.07 0v19.919a4.535 4.535 0 0 1-4.535 4.536z'/%3E%3Cpath fill='%23F9F9F9' d='M177.326 56.509V36.59c0-1.674.918-3.121 2.268-3.906a4.486 4.486 0 0 0-2.268-.629 4.535 4.535 0 0 0-4.535 4.535v19.919a4.535 4.535 0 0 0 4.535 4.535c.83 0 1.599-.239 2.268-.629-1.35-.785-2.268-2.231-2.268-3.906z'/%3E%3Cpath fill='%23F4F4F4' d='M126.789 63.064a4.535 4.535 0 0 1-4.535-4.535V45.877a4.533 4.533 0 0 1 4.535-4.535 4.533 4.533 0 0 1 4.535 4.535v12.652a4.535 4.535 0 0 1-4.535 4.535z'/%3E%3Cpath fill='%23F9F9F9' d='M126.789 58.529V45.877c0-1.674.918-3.121 2.268-3.907a4.486 4.486 0 0 0-2.268-.629 4.533 4.533 0 0 0-4.535 4.535v12.652a4.535 4.535 0 0 0 4.535 4.535c.83 0 1.599-.242 2.268-.632-1.35-.784-2.268-2.228-2.268-3.902z'/%3E%3Cpath fill='%23AA6148' d='M190.365 161.984c0-9.605-7.785-17.389-17.387-17.389-9.334 0-16.925 7.352-17.352 16.576l-.061-.021-.022.006c-.436-9.215-8.024-16.562-17.35-16.562-9.607 0-17.389 7.783-17.389 17.389 0 4.272 1.547 8.179 4.102 11.208h-.005l30.688 30.903 30.685-30.903h-.009a17.328 17.328 0 0 0 4.1-11.207z'/%3E%3Cpath fill='%23BC715C' d='M139.28 173.192h.004a17.33 17.33 0 0 1-4.101-11.208c0-7.036 4.184-13.081 10.193-15.818a17.267 17.267 0 0 0-7.183-1.571c-9.607 0-17.389 7.783-17.389 17.389 0 4.272 1.547 8.179 4.102 11.208h-.005l30.688 30.903 7.189-7.24-23.498-23.663z'/%3E%3Cg%3E%3Cpath fill='%23161616' d='M226.052 236.865a4.54 4.54 0 0 1-3.089-1.214 4.54 4.54 0 0 1-1.447-3.36c.001-.089.016-.425.022-.514l.001-15.827a4.536 4.536 0 0 1 3.979-4.5c13.488-1.668 24.884-12.998 24.884-24.741v-43.851c0-7.509-1.798-24.977-18.458-24.977h-5.87a4.536 4.536 0 0 1-4.535-4.535V97.044a4.535 4.535 0 0 1 4.535-4.535h5.87c26.217 0 43.832 20.235 43.832 50.35v43.851c0 25.432-22.141 47.926-49.358 50.14a4.93 4.93 0 0 1-.366.015zm4.559-17.123v7.382c20.015-3.951 36.096-21.478 36.096-40.414v-43.851c0-25.078-13.645-41.279-34.761-41.279h-1.335v7.231h1.335c20.297 0 27.528 17.589 27.528 34.048v43.851c0 15.15-12.623 29.244-28.863 33.032zM152.323 58.889a4.535 4.535 0 0 1-4.535-4.535V29.055a4.535 4.535 0 1 1 9.07 0v25.299a4.535 4.535 0 0 1-4.535 4.535zM177.326 61.045a4.535 4.535 0 0 1-4.535-4.535V36.59a4.535 4.535 0 1 1 9.07 0v19.919a4.533 4.533 0 0 1-4.535 4.536zM126.789 63.064a4.535 4.535 0 0 1-4.535-4.535V45.877a4.535 4.535 0 1 1 9.07 0v12.652a4.535 4.535 0 0 1-4.535 4.535zM155.59 208.631a4.53 4.53 0 0 1-3.219-1.341l-30.688-30.903a5.016 5.016 0 0 1-.251-.275 21.981 21.981 0 0 1-5.163-14.129c0-12.088 9.836-21.924 21.924-21.924a21.857 21.857 0 0 1 17.39 8.572 21.866 21.866 0 0 1 17.395-8.572c12.088 0 21.923 9.836 21.923 21.924a21.95 21.95 0 0 1-4.984 13.91c-.128.174-.269.34-.424.493l-30.685 30.903a4.522 4.522 0 0 1-3.218 1.342zm-27.325-38.495 27.325 27.522 27.274-27.469a12.875 12.875 0 0 0 2.966-8.206c0-7.087-5.765-12.853-12.852-12.853a12.82 12.82 0 0 0-12.821 12.251 4.537 4.537 0 0 1-1.978 3.54 4.57 4.57 0 0 1-3.802.611 4.546 4.546 0 0 1-3.365-4.16c-.323-6.865-5.956-12.242-12.819-12.242-7.088 0-12.853 5.767-12.853 12.853 0 2.965 1.038 5.856 2.925 8.153zM49.907 275.481c-7.299 0-13.795-2.442-18.559-7.205-11.953-11.961-8.514-34.845 7.662-51.011 16.174-16.175 39.054-19.618 51.011-7.659 11.666 11.666 8.815 33.528-6.489 49.768a4.535 4.535 0 1 1-6.602-6.218c11.721-12.437 14.715-29.096 6.678-37.136-8.414-8.406-25.546-4.978-38.185 7.659-12.426 12.419-15.934 29.905-7.661 38.185 5.126 5.126 13.835 5.97 23.298 2.256a4.541 4.541 0 0 1 5.879 2.566 4.537 4.537 0 0 1-2.566 5.879c-4.983 1.953-9.885 2.916-14.466 2.916z'/%3E%3Cpath fill='%23161616' d='M186.949 275.478H124.22c-18.125 0-34.091-10.937-40.671-27.862a4.54 4.54 0 0 1 .245-3.815c5.916-10.848 5.842-21.753-.186-27.782a13.629 13.629 0 0 0-1.314-1.128 4.539 4.539 0 0 1-1.736-3.57v-88.91a4.535 4.535 0 0 1 9.07 0v86.813c.134.127.267.254.397.384 8.533 8.536 9.542 22.71 2.753 36.561 5.619 12.36 17.753 20.238 31.441 20.238h62.729c19.073 0 34.591-15.52 34.591-34.594V82.29H89.629v19.199a4.535 4.535 0 0 1-9.07 0V77.754a4.535 4.535 0 0 1 4.535-4.535h140.982a4.535 4.535 0 0 1 4.535 4.535v154.059c0 24.076-19.587 43.665-43.662 43.665z'/%3E%3Cpath fill='%23161616' d='M37.36 266.575a4.536 4.536 0 0 1-.137-9.068l.847-.027c10.884-.322 17.454-.52 19.633-20.067 2.489-22.331 18.819-26.639 27.081-25.783a4.534 4.534 0 0 1 4.051 4.972 4.537 4.537 0 0 1-4.946 4.054c-1.563-.139-15.109-.735-17.172 17.761-3.05 27.378-17.095 27.794-28.379 28.131l-.836.024c-.046.003-.095.003-.142.003z'/%3E%3C/g%3E%3C/svg%3E");`,
    members: [
      {
        id: 'm15',
        name: 'Charles Darwin',
        role: 'Naturalist & Biologist',
        profile: '/images/coffee-bean.png',
      },
      {
        id: 'm16',
        name: 'Gregor Mendel',
        role: 'Father of Genetics',
        profile: '/images/coffee-bean.png',
      },
      {
        id: 'm17',
        name: 'Jane Goodall',
        role: 'Primatologist',
        profile: '/images/coffee-bean.png',
      },
      {
        id: 'm18',
        name: 'Louis Pasteur',
        role: 'Microbiologist',
        profile: '/images/coffee-bean.png',
      },
      {
        id: 'm19',
        name: 'Rachel Carson',
        role: 'Marine Biologist & Author',
        profile: '/images/coffee-bean.png',
      },
      {
        id: 'm20',
        name: 'Alexander Fleming',
        role: 'Discoverer of Penicillin',
        profile: '/images/coffee-bean.png',
      },
      {
        id: 'm21',
        name: 'Francis Crick',
        role: 'Co-discoverer of DNA',
        profile: '/images/coffee-bean.png',
      },
    ],
  },
  {
    id: 'g4',
    name: 'دانه قهوه',
    icon: <Rocket size="100%" />,
    svg: `url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 300 300' xml:space='preserve'%3E%3Cpath fill='%23F4F4F4' d='M84.353 35.136v23.913l-27.72 205.814h131.29l27.72-205.814V35.136z'/%3E%3Cpath fill='%23F9F9F9' d='m84.353 59.049-27.72 205.814h20.409l27.72-205.814z'/%3E%3Cpath fill='%23E5E5E4' d='m243.366 264.863-27.242-10.769-28.201 10.769 27.72-205.814z'/%3E%3Cpath fill='%23E5E5E4' d='m215.643 35.136 23.253 33.291h-21.989l-1.264-9.378z'/%3E%3Cpath fill='%23AA6148' d='M159.048 180.644c-17.492 17.494-41.704 21.648-54.075 9.282-12.359-12.37-8.212-36.58 9.289-54.072 17.493-17.495 41.697-21.649 54.066-9.283 12.369 12.369 8.221 36.578-9.28 54.073z'/%3E%3Cpath fill='%23BC715C' d='M122.201 143.791c15.572-15.577 36.448-20.542 49.573-12.725-.966-1.618-2.088-3.138-3.446-4.495-12.366-12.366-36.572-8.212-54.064 9.283-17.501 17.492-21.649 41.701-9.289 54.072 1.358 1.357 2.879 2.481 4.497 3.443-7.816-13.128-2.853-34.004 12.729-49.578z'/%3E%3Cpath fill='%23BC715C' d='M110.21 191.035c-.763 0-1.528-.009-2.299-.024a4.535 4.535 0 0 1 .165-9.067c12.915.23 23.105.421 25.915-25.429 3.614-33.246 31.59-30.822 31.873-30.794a4.537 4.537 0 0 1 4.059 4.968c-.25 2.485-2.474 4.326-4.943 4.06-2.002-.167-19.392-.988-21.971 22.746-3.265 30.018-17.175 33.54-32.799 33.54z'/%3E%3Cpath fill='%23F9F9F9' d='M84.353 35.136h20.409v23.913H84.353z'/%3E%3Cg%3E%3Cpath fill='%23161616' d='M187.924 269.398h-82.647a4.535 4.535 0 1 1 0-9.07h78.681l26.499-196.743H88.32L61.821 260.328h22.534a4.535 4.535 0 1 1 0 9.07h-27.72a4.54 4.54 0 0 1-4.496-5.141L79.86 58.444a4.535 4.535 0 0 1 4.494-3.93h131.29a4.539 4.539 0 0 1 4.496 5.14l-27.722 205.814a4.534 4.534 0 0 1-4.494 3.93z'/%3E%3Cpath fill='%23161616' d='M243.366 269.398a4.555 4.555 0 0 1-1.667-.317l-25.6-10.12-26.557 10.14a4.535 4.535 0 0 1-6.114-4.842l27.72-205.814c.304-2.25 2.225-3.93 4.495-3.93s4.191 1.68 4.495 3.93l11.966 88.842a4.537 4.537 0 0 1-3.89 5.101c-2.46.334-4.764-1.406-5.101-3.89l-7.47-55.47-22.206 164.877 21.071-8.046a4.52 4.52 0 0 1 3.285.019l20.045 7.924-11.905-88.381a4.537 4.537 0 0 1 3.89-5.101c2.48-.317 4.767 1.408 5.101 3.89l12.937 96.049a4.538 4.538 0 0 1-4.495 5.139z'/%3E%3Cpath fill='%23161616' d='M215.644 63.585H84.354a4.535 4.535 0 0 1-4.535-4.535V35.136a4.535 4.535 0 0 1 4.535-4.535h131.29a4.535 4.535 0 0 1 4.535 4.535v23.913a4.533 4.533 0 0 1-4.535 4.536zM88.89 54.514h122.219V39.672H88.89v14.842z'/%3E%3Cpath fill='%23161616' d='M238.898 72.962h-21.99a4.534 4.534 0 0 1-4.494-3.93l-1.264-9.378a4.382 4.382 0 0 1-.041-.605V35.136a4.534 4.534 0 0 1 8.253-2.597l23.254 33.291a4.533 4.533 0 0 1-3.718 7.132zm-18.024-9.07h9.325L220.18 49.549v9.196l.694 5.147zM123.798 201.503c-8.479 0-16.212-2.721-21.863-8.37-14.114-14.129-9.946-41.261 9.289-60.488 19.23-19.233 46.362-23.4 60.479-9.282 7.054 7.053 9.833 17.383 7.825 29.087-1.91 11.132-7.984 22.283-17.105 31.401v-.001.001c-11.535 11.536-25.916 17.652-38.625 17.652zm25.953-77.575c-10.236 0-22.287 5.306-32.114 15.133-15.7 15.692-19.866 37.072-9.288 47.66 10.583 10.575 31.963 6.412 47.66-9.283v-.002c7.806-7.803 12.983-17.22 14.578-26.517 1.495-8.721-.385-16.228-5.297-21.141-3.957-3.956-9.424-5.85-15.539-5.85z'/%3E%3Cpath fill='%23161616' d='M110.378 191.035c-.763 0-1.528-.009-2.299-.024a4.533 4.533 0 0 1-4.451-4.617c.044-2.504 2.136-4.627 4.617-4.451 12.915.23 23.105.421 25.915-25.429 3.614-33.246 31.593-30.822 31.873-30.794a4.538 4.538 0 0 1 4.059 4.968c-.251 2.485-2.479 4.304-4.943 4.06-1.995-.167-19.391-.988-21.971 22.746-3.265 30.019-17.176 33.541-32.8 33.541z'/%3E%3C/g%3E%3C/svg%3E");`,
    members: [
      {
        id: 'm22',
        name: 'Nikola Tesla',
        role: 'Inventor & Engineer',
        profile: '/images/coffee-bean.png',
      },
      {
        id: 'm23',
        name: 'Leonardo da Vinci',
        role: 'Inventor & Polymath',
        profile: '/images/coffee-bean.png',
      },
      {
        id: 'm24',
        name: 'Hedy Lamarr',
        role: 'Inventor & Actress',
        profile: '/images/coffee-bean.png',
      },
      {
        id: 'm25',
        name: 'Thomas Edison',
        role: 'Inventor & Businessman',
        profile: '/images/coffee-bean.png',
      },
      {
        id: 'm26',
        name: 'Archimedes',
        role: 'Ancient Engineer',
        profile: '/images/coffee-bean.png',
      },
      {
        id: 'm27',
        name: 'Grace Hopper',
        role: 'Computer Scientist',
        profile: '/images/coffee-bean.png',
      },
      {
        id: 'm28',
        name: 'Elon Musk',
        role: 'Engineer & Entrepreneur',
        profile: '/images/coffee-bean.png',
      },
    ],
  },
]

// --- Utility Hooks & Functions ---
const useIsMobile = (breakpoint = 768) => {
  const [isMobile, setIsMobile] = useState(false)
  useEffect(() => {
    if (typeof window === 'undefined') return
    const checkScreenSize = () => setIsMobile(window.innerWidth < breakpoint)
    checkScreenSize()
    window.addEventListener('resize', checkScreenSize)
    return () => window.removeEventListener('resize', checkScreenSize)
  }, [breakpoint])
  return isMobile
}

const safeImage = (e: React.SyntheticEvent<HTMLImageElement, Event>) => {
  const target = e.target as HTMLImageElement
  target.src = '/images/coffee-bean.png'
}

// --- Main Component ---
export default function DualOrbitCarousel() {
  const [activeGroupIndex, setActiveGroupIndex] = useState(0)
  const [isHovering, setIsHovering] = useState(false) // For pausing carousel
  const isMobile = useIsMobile()

  const activeGroup = useMemo(() => data[activeGroupIndex], [activeGroupIndex])

  // --- Dimensions ---
  const outerRadius = isMobile ? 140 : 200
  const innerRadius = isMobile ? 60 : 90
  const memberSize = isMobile ? 50 : 64
  const groupSize = isMobile ? 40 : 56
  const containerSize = outerRadius * 2 + memberSize

  // --- Animation Durations ---
  const OUTER_ORBIT_DURATION = 45
  const INNER_ORBIT_DURATION = 30

  // --- Handlers ---
  const handleGroupClick = (index: number) => {
    if (index === activeGroupIndex) return
    setActiveGroupIndex(index)
  }

  // ⭐ NEW: Auto-play carousel for inner groups
  useEffect(() => {
    if (isHovering) return // Pause auto-play on hover

    const timer = setInterval(() => {
      setActiveGroupIndex((prev) => (prev + 1) % data.length)
    }, 4000) // Change group every 4 seconds

    return () => clearInterval(timer)
  }, [isHovering])

  return (
    <div
      className="   flex items-center justify-center relative w-full overflow-hidden transition-colors duration-300"
      style={{ height: containerSize }}
      onMouseEnter={() => setIsHovering(true)}
      onMouseLeave={() => setIsHovering(false)}
    >
      <div
        className="relative "
        style={{ width: containerSize, height: containerSize }}
      >
        {/* Outer Orbit (Members) */}
        <AnimatePresence>
          <motion.div
            key={activeGroup.id}
            className="absolute top-0 left-0 w-full h-full"
            initial={{ opacity: 0, scale: 0.8 }}
            animate={{ opacity: 1, scale: 1, rotate: 360 }}
            exit={{ opacity: 0, scale: 0.8 }}
            transition={{
              opacity: { duration: 0.4 },
              scale: { duration: 0.4 },
              rotate: {
                repeat: Infinity,
                duration: OUTER_ORBIT_DURATION,
                ease: 'linear',
              },
            }}
          >
            {activeGroup.members.map((member, i) => {
              const angle = (i / activeGroup.members.length) * 360
              return (
                <div
                  key={member.id}
                  className="absolute top-1/2 left-1/2 flex flex-col items-center justify-center gap-1 "
                  style={{
                    transform: `translate(-50%, -50%) rotate(${angle}deg) translateY(-${outerRadius}px)`,
                  }}
                >
                  <p>{member.name}</p>
                  {/* ⭐ FIX: This inner motion.img now counter-rotates */}
                  <motion.img
                    src={member.profile}
                    alt={member.name}
                    onError={safeImage}
                    // className="object-cover rounded-full shadow-md border-2 border-gray-300 dark:border-gray-600"
                    className="object-cover rounded-full shadow-md  "
                    style={{
                      width: memberSize,
                      height: memberSize,
                    }}
                    animate={{ rotate: -360 }}
                    transition={{
                      repeat: Infinity,
                      duration: OUTER_ORBIT_DURATION,
                      ease: 'linear',
                    }}
                    whileHover={{
                      scale: 1.2,
                      zIndex: 50,
                      borderColor: 'rgb(99 102 241)',
                    }}
                  />
                </div>
              )
            })}
          </motion.div>
        </AnimatePresence>

        {/* Inner Orbit (Groups) */}
        <motion.div
          className="absolute top-0 left-0 w-full h-full"
          animate={{ rotate: -360 }}
          transition={{
            repeat: Infinity,
            duration: INNER_ORBIT_DURATION,
            ease: 'linear',
          }}
        >
          {data.map((group, i) => {
            const angle = (i / data.length) * 360
            const isActive = i === activeGroupIndex
            return (
              <div
                key={group.id}
                className="absolute top-1/2 left-1/2 flex flex-col items-center justify-center gap-1"
                style={{
                  transform: `translate(-50%, -50%) rotate(${angle}deg) translateY(-${innerRadius}px)`,
                  //   backgroundImage: '/images/4.png',
                  //   maskImage: group.svg,
                  //   maskSize: 'contain',
                  //   maskRepeat: 'no-repeat',
                  //   maskPosition: 'center',
                }}
              >
                <p>{group.name}</p>
                {/* ⭐ FIX: This inner motion.div now counter-rotates */}
                <motion.div
                  onClick={() => handleGroupClick(i)}
                  className="flex items-center justify-center rounded-full cursor-pointer bg-transparent dark:bg-gray-800 text-indigo-500 dark:text-indigo-400 p-2 shadow-lg"
                  style={{
                    width: groupSize,
                    height: groupSize,
                  }}
                  animate={{
                    scale: isActive ? 1.2 : 1,
                    borderColor: isActive
                      ? 'rgb(99 102 241)'
                      : 'rgb(209 213 219)',
                    borderWidth: isActive ? (isMobile ? 2 : 3) : 1,
                    rotate: 360,
                  }}
                  transition={{
                    // Define separate transitions for each animated property
                    scale: { type: 'spring', stiffness: 300, damping: 15 },
                    borderColor: {
                      type: 'spring',
                      stiffness: 300,
                      damping: 15,
                    },
                    borderWidth: {
                      type: 'spring',
                      stiffness: 300,
                      damping: 15,
                    },
                    rotate: {
                      repeat: Infinity,
                      duration: INNER_ORBIT_DURATION,
                      ease: 'linear',
                    },
                  }}
                  whileHover={{ scale: 1.3, rotate: 375 }} // Slight extra rotation on hover
                >
                  {group.icon}
                </motion.div>
              </div>
            )
          })}
        </motion.div>
      </div>
    </div>
  )
}
